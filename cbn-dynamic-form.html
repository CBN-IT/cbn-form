<!--
`cbn-dynamic-form` is an extensible dynamic form component that renders dynamic form fields (via an user-supplied 
configuration object).

Example:
    <cbn-form url="/do/something/save" method="post">
    	<cbn-dynamic-form config="{{formInputs}}"></cbn-dynamic-form>
    	<button is="cbn-form-button" type="submit"></button>
    </cbn-form>

Where `config` is a custom object that describes the form's layout and the input fields to be dynamically generated.

Example config JSON definition: 
	{
		groups: [{
			caption: 'Main Form', 
			fields: [
				{
					name: 'name',
					label: 'Name: ', 
					type: 'text', 
					element: 'cbn-basic-input', 
					preview: true
				}, 
				{
					name: 'type',
					label: 'Type: ', 
					type: 'select',
					options: { 1: 'Person', 2: 'Company' }
				}
			]
		}]
	}

@group cbn-form
@element cbn-dynamic-form
-->

<!-- Imports -->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="cbn-form-group.html">
<link rel="import" href="cbn-dynamic-input.html">

<polymer-element name="cbn-dynamic-form" attributes="config model">
	<template>
		<link rel="stylesheet" href="../flexboxgrid/dist/flexboxgrid.min.css">
		
		<div id="groups">
			<template repeat="{{group in config.groups}}">
				
				<cbn-form-group caption="[[group.caption]]" 
								class="[[group.className | toClassList]]"
								style="[[group.style | styleObject]]">
					<div class="{{ { 'group-inner': true, 'row': group.flexgrid } | tokenList }}">
						<template repeat="{{field in group.fields}}">
							<cbn-dynamic-input config="[[field]]"></cbn-dynamic-input>
						</template>
					</div>
				</cbn-form-group>
				
			</template>
		</div>
		
	</template>
	
	<script>
		Polymer('cbn-dynamic-form', {
			
			/**
			 * The form configuration object.
			 * @typedef  {Object} 	FormGroupConfig
			 * @property {String} 	caption Group's caption / title (optional)
			 * @property {Boolean}	toggleable Whether the group is toggleable.
			 * @property {[Object]}	fields Form's fields to be rendered
			 */
			
			/**
			 * The form configuration object.
			 * @typedef {Object} 				FormConfig
			 * @property {[FormGroupConfig]} 	groups The grouped form fields
			 */
			
			/**
			 * The form configuration object that contains the inputs to be rendered, their layout and their properties.
			 * 
			 * @type {FormConfig}
			 * @default {}
			 */
			config: null,
			
			/**
			 * Dynamic form's data model to use for its inputs. If not set, the parent form will manage the fields.
			 * 
			 * @attribute model
			 * @type {Object}
			 * @default null
			 */
			model: null,
			
			/**
			 * Stores the element's parent `cbn-form`.
			 * 
			 * @type {HTMLElement}
			 */
			parentForm: null,
			
			/**
			 * Fires when the element is created. Used to initialize its attributes.
			 */
			created: function() {
				if (!this.config) 
					this.config = {};
			}, 
			
			/**
			 * Called when polymer element has been fully prepared.
			 * 
			 * Listens for input attached / detached events and initializes them.
			 */
			ready: function() {
				var form = this;
				
				if (this.model) {
					this.addEventListener('cbn-form-input-attached', function (event) {
						var input = event.detail.input;
						if (event.detail.bindValue) {
							this.bindValue(input);
							event.detail.bindValue = false; // first-come, first-served
						}
					});
					
					this.addEventListener('cbn-form-input-detached', function (event) {
						var input = event.detail.input;
						if (event.detail.unbindValue) {
							this.unbindValue(input);
							event.detail.unbindValue = false;
						}
					});
				}
			},
			
			/**
			 * Converts an array of strings to HTML space-separated classes list.
			 * 
			 * @param {String|String[]} classes The input.
			 * @return {String} The resulting HTML classes list.
			 */
			toClassList: function(classes) {
				if (!classes || typeof classes == 'string')
					return classes;
				return classes.join(' ');
			}
			
		});
	</script>
	
</polymer-element>
