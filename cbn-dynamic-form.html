<!--
`cbn-dynamic-form` is an extensible dynamic form component that renders dynamic form fields (via an user-supplied 
configuration object).

Example:
    <cbn-form url="/do/something/save" method="post">
    	<cbn-dynamic-form config="{{formInputs}}"></cbn-dynamic-form>
    	<button is="cbn-form-button" type="submit"></button>
    </cbn-form>

Where `config` is a custom object that describes the form's layout and the input fields to be dynamically generated.

Example config JSON definition: 
	{
		groups: [{
			caption: 'Main Form', 
			fields: [
				{
					name: 'name',
					label: 'Name: ', 
					type: 'text', 
					element: 'cbn-basic-input', 
					preview: true
				}, 
				{
					name: 'type',
					label: 'Type: ', 
					type: 'select',
					options: { 1: 'Person', 2: 'Company' }
				}
			]
		}]
	}

@group cbn-form
@element cbn-dynamic-form
-->

<!-- Imports -->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="cbn-form-group.html">
<link rel="import" href="cbn-dynamic-input.html">

<polymer-element name="cbn-dynamic-form" attributes="config model">
	<template>
		
		<div id="groups">
			<template repeat="{{group in config.groups}}">
				
				<cbn-form-group caption="[[group.caption]]">
					<template repeat="{{field in group.fields}}">
						<cbn-dynamic-input class="[[ { preview: field.preview } | tokenList ]]"
											config="[[field]]"></cbn-dynamic-input>
					</template>
				</cbn-form-group>
				
			</template>
		</div>
		
	</template>
	
	<script>
		Polymer('cbn-dynamic-form', {
			
			/**
			 * The form configuration object.
			 * @typedef  {Object} 	FormGroupConfig
			 * @property {String} 	caption Group's caption / title (optional)
			 * @property {Boolean}	toggleable Whether the group is toggleable.
			 * @property {[Object]}	fields Form's fields to be rendered
			 */
			
			/**
			 * The form configuration object.
			 * @typedef {Object} 				FormConfig
			 * @property {[FormGroupConfig]} 	groups The grouped form fields
			 */
			
			/**
			 * The form configuration object that contains the inputs to be rendered, their layout and their properties.
			 * 
			 * @type {FormConfig}
			 * @default {}
			 */
			config: {},
			
			/**
			 * Dynamic form's data model to use for its inputs. If not set, the parent form will manage the fields.
			 * 
			 * @attribute model
			 * @type {Object}
			 * @default null
			 */
			model: null,
			
			/**
			 * Stores the element's parent `cbn-form`.
			 * 
			 * @type {HTMLElement}
			 */
			parentForm: null,
			
			/**
			 * Called when polymer element has been fully prepared.
			 * 
			 * Listens for input attached / detached events and initializes them.
			 */
			ready: function() {
				var form = this;
				
				if (this.model) {
					this.addEventListener('cbn-form-input-attached', function (event) {
						var input = event.detail.input;
						if (event.detail.bindValue) {
							input.bind('value', new PathObserver(this.model, input.name));
							event.detail.bindValue = false; // first-come, first-served
						}
					});

					this.addEventListener('cbn-form-input-detached', function (event) {
						var input = event.detail.input;
						if (event.detail.unbindValue) {
							input.unbind('value');
							event.detail.unbindValue = false;
						}
					});
				}
			}
			
		});
	</script>
	
</polymer-element>
