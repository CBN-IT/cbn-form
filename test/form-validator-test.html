<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	
	<script src="../../webcomponentsjs/webcomponents.min.js"></script>
	<script src="../../web-component-tester/browser.js"></script>
	
	<!-- Elements to be tested -->
	<link rel="import" href="../cbn-form.html">
	<link rel="import" href="../basic-components/basic-input.html">
	<link rel="import" href="../cbn-form-validator.html">
	
</head>
<body>

<cbn-form id="firstForm">
	
	<input is="cbn-basic-input" type="text" title="One" id="input1_1" preview name="one" />
	<input is="cbn-basic-input" type="text" title="Two" id="input1_2" name="two" />
	
	<input is="cbn-basic-input" type="text" title="Three" id="input1_3" name="three" />
	<input is="cbn-basic-input" type="text" title="Four" id="input1_4" name="four" />
	
	<input is="cbn-basic-input" type="text" title="Five" id="input1_5" name="five" />
	<input is="cbn-basic-input" type="text" title="Six" id="input1_6" name="six" />
	
	<input is="cbn-basic-input" type="text" title="Seven" id="input1_7" name="seven" />
	<input is="cbn-basic-input" type="text" title="Eight" id="input1_8" name="eight" />
</cbn-form>

<script>
	
	var form = document.querySelector('#firstForm');
	
	// Set-up the test suite
	suiteSetup(function(done){
		// hack for polyfilled elements, need to refetch the proxied element
		form = document.querySelector('#firstForm');
		flush(done);
	});
	
	test('required validation & messages', function (done) {
		var input1_1 = form.querySelector('#input1_1');
		var input1_2 = form.querySelector('#input1_2');
		var input1_3 = form.querySelector('#input1_3');
		var input1_4 = form.querySelector('#input1_4');
		
		input1_1.validation = {
			required: false
		};
		input1_2.validationMessage = 'This is a test message!';
		input1_2.validation = {
			required: true
		};
		input1_3.validation = {
			required: { validate: true, message: 'test' }
		};
		input1_4.validation = {
			required: { validate: true, message: 'this is required, bo$$' }
		};
		
		input1_1.value = '';
		input1_2.value = '';
		input1_3.value = 'not empty';
		input1_4.value = '';
		
		flush(function(){
			assert.ok(input1_1.validate(), 'required:false validation');
			assert.equal(input1_1.validationState.message, '', 'success empty validation message');
			
			assert.notOk(input1_2.validate(), 'required:true validation');
			assert.equal(input1_2.validationState.message, 'This is a test message!', 'default validation message');
			
			assert.ok(input1_3.validate(), 'required:true positive validation');
			
			input1_4.validate();
			assert.equal(input1_4.validationState.message, 'this is required, bo$$', 'per-validator validation message');
			
			assert.notOk(form.validate(), 'form validation');
			
			done();
		});
	});
	
	test('text validation', function (done) {
		var input1_1 = form.querySelector('#input1_1');
		var input1_2 = form.querySelector('#input1_2');
		var input1_3 = form.querySelector('#input1_3');
		var input1_4 = form.querySelector('#input1_4');
		var input1_5 = form.querySelector('#input1_5');
		
		var testLengthValidation = {
			minlength: 2,
			maxlength: 4
		};
		
		input1_1.validation = testLengthValidation;
		input1_2.validation = testLengthValidation;
		input1_3.validation = testLengthValidation;
		input1_4.validation = input1_5.validation = {
			pattern: { validate: '^[a-z0-9]+$', modifiers: 'i', message: 'test2' }
		};
		
		input1_1.value = '1';
		input1_2.value = '111';
		input1_3.value = '1111111111';
		input1_4.value = 'this, is, not, correct';
		input1_5.value = 'ThiSIsCorrect';
		
		flush(function(){
			assert.notOk(input1_1.validate(), 'minlength/maxlength validation 1');
			assert.ok(input1_2.validate(), 'minlength/maxlength validation 2');
			assert.notOk(input1_3.validate(), 'minlength/maxlength validation 3');
			
			assert.notOk(input1_4.validate(), 'pattern negative validation');
			assert.ok(input1_5.validate(), 'pattern positive validation');
			
			done();
		});
	});
	
	test('pattern validation', function (done) {
		var input1_1 = form.querySelector('#input1_1');
		var input1_2 = form.querySelector('#input1_2');
		
		input1_1.validation = input1_2.validation = {
			email: true
		};
		
		input1_1.value = 'test@example.com';
		input1_2.value = 'you shall not pass';
		
		flush(function(){
			assert.ok(input1_1.validate(), 'email positive validation');
			assert.notOk(input1_2.validate(), 'email negative validation');
			
			done();
		});
	});
	
	test('numeric validation', function (done) {
		var input1_1 = form.querySelector('#input1_1');
		var input1_2 = form.querySelector('#input1_2');
		var input1_3 = form.querySelector('#input1_3');
		var input1_4 = form.querySelector('#input1_4');
		var input1_5 = form.querySelector('#input1_5');
		var input1_6 = form.querySelector('#input1_6');
		var input1_7 = form.querySelector('#input1_7');
		var input1_8 = form.querySelector('#input1_8');
		
		input1_1.validation = input1_2.validation = { number: true };
		input1_1.value = '6534873';
		input1_2.value = '345k234';
		
		input1_3.validation = input1_4.validation = { number: { validate: true, type: 'float' } };
		input1_3.value = '6534.873';
		input1_4.value = '345la.234';
		
		input1_5.validation = input1_6.validation = { min: 19 };
		input1_7.validation = input1_8.validation = { max: 19 };
		input1_5.value = '20';
		input1_6.value = '18';
		input1_7.value = '18.9';
		input1_8.value = '19.1';
		
		flush(function(){
			assert.ok(input1_1.validate(), 'integer positive validation');
			assert.notOk(input1_2.validate(), 'integer negative validation');
			
			assert.ok(input1_3.validate(), 'float positive validation');
			assert.notOk(input1_4.validate(), 'float negative validation');
			
			assert.ok(input1_5.validate(), 'min positive validation');
			assert.notOk(input1_6.validate(), 'min negative validation');
			
			assert.ok(input1_7.validate(), 'max positive validation');
			assert.notOk(input1_8.validate(), 'max negative validation');
			
			done();
		});
	});
	
</script>

</body>
</html>
